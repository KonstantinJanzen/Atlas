/*------------------------------------------------------------------------
# MD Slider - March 18, 2013
# ------------------------------------------------------------------------
# Websites:  http://www.megadrupal.com -  Email: info@megadrupal.com
--------------------------------------------------------------------------*/

!function(e){var t=function(t){var i=this;this.panel=t,this.selectedItem=null,this.textItemTemplate='<div class="md-item clearfix"><div class="mdi-view"><a href="#" class="btn-viewlayer"></a></div><div class="mdi-name"><span class="mdit-text"></span><span class="title">&nbsp;</span><a href="#" class="btn-deletelayer"></a><a href="#" class="btn-clonelayer"></a></div><div class="mdtl-times"><div class="mdi-frame"></div></div></div>',this.imageItemTemplate='<div class="md-item clearfix"><div class="mdi-view"><a href="#" class="btn-viewlayer"></a></div><div class="mdi-name"><span class="mdit-image"></span><span class="title">&nbsp;</span><a href="#" class="btn-deletelayer"></a><a href="#" class="btn-clonelayer"></a></div><div class="mdtl-times"><div class="mdi-frame"></div></div></div>',this.videoItemTemplate='<div class="md-item clearfix"><div class="mdi-view"><a href="#" class="btn-viewlayer"></a></div><div class="mdi-name"><span class="mdit-video"></span><span class="title">&nbsp;</span><a href="#" class="btn-deletelayer"></a><a href="#" class="btn-clonelayer"></a></div><div class="mdtl-times"><div class="mdi-frame"></div></div></div>',this.maxStart=0,this.rulewidth=7,this.init=function(){i.rulewidth=e(".mdtl-ruler").width()/200,e("#slideshow-time").css("left",100*i.rulewidth),e("#timeline-items").width(100*i.rulewidth+257),e("a.btn-viewlayer").live("click",function(){var t=e(this).parent().parent(),a=t.data("box");return null!=a&&(e(this).hasClass("btn-blank")?(a.show(),a.attr("ishidden","false"),t.removeClass("box-hide"),e(this).removeClass("btn-blank")):(a.hide(),a.attr("ishidden","true"),a.removeClass("ui-selected"),t.addClass("box-hide"),i.panel.triggerChangeSelectItem(),e(this).addClass("btn-blank"))),!1}),e("a.btn-deletelayer").live("click",function(){var t=e(this).parent().parent(),a=t.data("box");return null!=a&&(t.remove(),a.remove(),i.panel.triggerChangeSelectItem()),!1}),e("a.btn-clonelayer").live("click",function(){var t=e(this).parent().parent(),a=t.data("box");return null!=a&&i.panel.cloneBoxItem(a),!1}),e("#timeline-items").sortable({handle:".mdi-name",update:function(){i.triggerChangeOrderItem()},placeholder:"md-item"}),e("#slideshow-time").draggable({axis:"x",grid:[i.rulewidth,20],containment:"parent",drag:function(e,t){return t.position.left<=i.maxStart+i.rulewidth?!1:i.updateTimelineWidth()}})},this.updateTimelineWidth=function(){var t=e("#slideshow-time").position().left;return i.panel.setTimelineWidth(Math.round(t/i.rulewidth)),e("#timeline-items").width(257+t),e("#timeline-items .md-item").each(function(){var a=e(this).find(".mdi-frame"),l=e(this).data("box");null!=l&&a.position().left+a.width()>t&&(a.width(t-a.position().left),l.data("stoptime",t/i.rulewidth*100),i.panel.changeTimelineValue())}),!0},this.addTimelineItem=function(t,a){var l;l="text"==t?e(this.textItemTemplate).clone():"image"==t?e(this.imageItemTemplate).clone():e(this.videoItemTemplate).clone();var s=a.data("title");l.find("span.title").html(s);var n=a.data("starttime")?a.data("starttime"):0,d=a.data("stoptime")?a.data("stoptime"):Math.round((e("#timeline-items").width()-257)/i.rulewidth*100);d>n&&(l.find("div.mdi-frame").css({left:n*i.rulewidth/100,width:(d-n)*i.rulewidth/100}),(null==a.data("starttime")||null==a.data("stoptime"))&&(a.data("starttime",n),a.data("stoptime",d),i.panel.changeTimelineValue())),l.data("box",a),"true"==a.attr("ishidden")&&(l.addClass("box-hide"),e("a.btn-viewlayer",l).addClass("btn-blank")),e("#timeline-items").prepend(l),e(l).find("div.mdi-frame").draggable({containment:"parent",grid:[i.rulewidth,20],stop:function(t,a){var l=e(this).parent().parent(),s=l.data("box");if(null!=s){var n=e(a.helper).position();s.data("starttime",n.left/i.rulewidth*100),s.data("stoptime",(n.left+e(a.helper).width())/i.rulewidth*100),s.hasClass("ui-selected")&&i.panel.triggerChangeSettingItem()}i.changeMaxStart()}}),e(l.find("div.mdi-frame")).resizable({handles:"e, w",containment:"parent",minWidth:2*i.rulewidth,grid:[i.rulewidth,20],stop:function(t,a){var l=e(this).parent().parent(),s=l.data("box");if(null!=s){var n=e(a.helper).position();s.data("starttime",Math.round(n.left/i.rulewidth*100)),s.data("stoptime",Math.round((n.left+e(a.helper).width())/i.rulewidth*100)),s.hasClass("ui-selected")&&i.panel.triggerChangeSettingItem()}i.changeMaxStart()}}),e(l).click(function(){if(!e(this).hasClass("active")&&!e(this).hasClass("box-hide")){var t=e(this).data("box");null!=t&&i.panel.changeSelectItem(t)}}),a.data("timeline",l)},this.changeMaxStart=function(){var t=0;e("#timeline-items .mdtl-times").each(function(){var i=e(this).find("div.mdi-frame").position().left;i>t&&(t=i)}),i.maxStart=t},this.changeSelectItem=function(e){this.selectedItem=e,i.triggerChangeSelectItem()},this.triggerChangeSelectItem=function(){if(e("#timeline-items > div.md-item.active").removeClass("active"),null!=this.selectedItem){var t=this.selectedItem.data("timeline");null!=t&&e(t).addClass("active")}},this.triggerChangeOrderItem=function(){e("#timeline-items .md-item").each(function(t){var i=e(this).data("box");null!=i&&i.css("z-index",1e3-t)})},this.changeSelectedItemTitle=function(){if(null!=this.selectedItem){var t=this.selectedItem.data("timeline");if(null!=t){var i=this.selectedItem.data("title");e(t).find("span.title").html(i)}}},this.setTimelineWidth=function(t){t&&(e("#slideshow-time").css("left",t*i.rulewidth),i.updateTimelineWidth())},this.changeActivePanel=function(){e("#timeline-items").html("");var t=i.panel.getTimelineWidth();null!=t?i.setTimelineWidth(t):i.panel.setTimelineWidth(e("#slideshow-time").position().left/i.rulewidth);var a=i.panel.getAllItemBox();a.sort(function(t,i){var a=parseInt(e(t).css("z-index")),l=parseInt(e(i).css("z-index"));return l>a?-1:a>l?1:0}),a.each(function(){i.addTimelineItem(e(this).data("type"),e(this))})},this.init()};window.MdSliderTimeline=t}(jQuery);
